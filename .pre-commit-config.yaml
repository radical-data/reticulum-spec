# Pre-commit config for SSOT (plan section 12.1)
# Hooks: YAML formatting (no trailing whitespace, consistent indentation);
# run tools/validate_ssot.py; run tools/compile_ssot.py; fail if diff in spec/generated.

repos:
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
      - id: trailing-whitespace
      - id: end-of-file-fixer
      - id: check-yaml

  - repo: local
    hooks:
      - id: validate-ssot
        name: Validate SSOT
        entry: uv run python tools/validate_ssot.py
        language: system
        pass_filenames: false

      - id: compile-ssot
        name: Compile SSOT
        entry: uv run python tools/compile_ssot.py
        language: system
        pass_filenames: false

      - id: generated-diff
        name: Generated files up to date
        entry: bash -c 'git diff --exit-code spec/generated || (echo "spec/generated has uncommitted changes; run uv run python tools/compile_ssot.py and commit." && exit 1)'
        language: system
        pass_filenames: false
